---
title: "Simulation of the data"
author: "Aryan Sultan"
date: "2023-03-29"
output: html_document
---


### Data simulation


Here I am not using any package to simulate the data.

```{r}
library(tidyverse)

total_patients <- 1000
arrival_rate <- 1/6  # average 6 patients per day

# Bed occupation time (in days) for each stroke level

bed_occupation_time <- list(
  very_mild = 1,
  mild = c(3, 7),
  moderate = 14,  # patients sent to rehab center may stay up to 2 weeks in the ward
  severe_nursing = 14,  # patients sent to nursing center may stay up to 2 weeks
  severe = 14
)

# Probability of each stroke level
stroke_level_prob <- c(0.1, 0.1, 0.1, 0.1, 0.6)

# Number of beds in the stroke ward
num_beds <- 25

# Initializing the queue 

queue <- list()

```

```{r}

# the function below is created to generate the inter-arrival times between the patients.

generate_interarrival_times <- function(total_patients, arrival_rate) {
  interarrival_times <- rexp(total_patients, rate = arrival_rate)
  return(interarrival_times)
}

# the function is created to assign patients (from total_patients) randomly a stroke level. This assignment is based on the probabilities defined in the stroke_level_prob. 

assign_stroke_levels <- function(total_patients, stroke_level_prob) {
  stroke_levels <- sample(1:length(stroke_level_prob), 
                          size = total_patients, replace = TRUE,
                          prob = stroke_level_prob)
  return(stroke_levels)
}

# if the probability of the severe stroke is really high, say 0.7, then the sample() function would generate random samples of 1000 patients wherein most patients would be assigned the severe stroke level category. I defined the total number of patients and the probabilities of the stroke level earlier.

interarrival_times <- generate_interarrival_times(total_patients, arrival_rate)
stroke_levels <- assign_stroke_levels(total_patients, stroke_level_prob)

arrivals_data <- data.frame(interarrival_times, stroke_levels)

# view(arrivals_data)


```


```{r}

# Update bed occupation times for all beds
update_bed_occupation_times <- function(beds, interarrival_time) {
  beds <- pmax(beds - interarrival_time, 0)
  return(beds)
}

# interarrival time is defined earlier in the code. This variable is based on the generate_interarrival_times function where we input the total number of patients and arrival rate.

# pmax function makes sure that the occupation times do not become negative. 0 in this context means that the bed is available (the patients has used up the service, now it is available for the other users to use)
```

```{r}
# Function to assign a bed to a patient
assign_bed <- function(beds, occupation_time) {
  available_beds <- which(beds == 0) # this finds the beds with occupation time equal to 0.
  if (length(available_beds) > 0) {
    beds[available_beds[1]] <- occupation_time
  }
  return(beds)
}

# this condition checks if there are beds available (if the length of the available beds vector is greater than zero then that means there are beds available for patients in the queue). If this condition is true then the first available bed in the vector will be set equal to the occupation time of the next patient

# Function to add a patient to the queue
add_to_queue <- function(queue, occupation_time) {
  queue <- append(queue, occupation_time)
  return(queue)
}

```

