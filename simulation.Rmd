---
title: "Simulation of the data"
author: "Aryan Sultan"
date: "2023-03-29"
output:
  html_document: default
  pdf_document: 
    bookdown::pdf_document2
---


### Brief Introduction

The simulation model based in the queue theory for MMRI stroke ward bed capacity forecast considered factors such as patient arrival rates, stroke severity probabilities, and bed occupation times. Patient arrival rates were estimated to be 6 patients/day, based on an annual patient load of ~2000. The distribution of stroke severity was as follows: very mild (probability = 0.2), mild (probability = 0.2), moderate (probability = 0.35), severe (probability = 0.1), and very severe (probability = 0.15). Bed occupation times ranged from 1 day (very mild) to 3-21 days (severe). The study explored 25-50 bed scenarios and considered an increase in patient arrival to 2500 in the near future. Simulation was run for 100 replications, evaluating performance measures (e.g., average queue length, maximum queue length, and capacity utilization) with an initial 25-bed provision.

### Work flow

In this section lets briefly explain the steps taken to create a stroke simulation model.

* Set Parameters
* Create functions for:
                 - Generating the inter-arrival times
                 - Assigning stroke categories to patients for simulation 
                 - Generate length of stay for patients based on the stroke categories of patients
                 - Create arrivals data that shows the inter-arrivals times of patients, their length 
                 of stay and the associated category of stroke.
* Create a simulation function that simulates the arrival and stay of 2000 patients with various stroke categories
* Create yet another function that runs simulation a for few hundreds replicates and computes the performance metrics for each simulation and averages them over producing mean performance metrics across multiples replication of simulations. 

### Parameters

```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(bookdown)

set.seed(2023)
# Parameters

total_patients <- 2000 # assuming there are 2000 all around the year
total_patients_future <- 2500 # assuming the 2500 patients in the future 
patients_per_month <- 2000/12 # patients per month
arrival_rate <- total_patients/365  # average 6 patients per day
arrival_rate_future <- total_patients_future/365 # average 7 patients per day

# Bed occupation time (in days) for each stroke level

bed_occupation_time <- list(c(4.43), c(4.46), c(6.67), c(6.92), c(7.74), c(9.29))


# Probability of each stroke level
stroke_level_prob <- c(0.0570,0.342, 0.217, 0.136, 0.0971, 0.151)
```

Below one can see the table \@ref(tab:bed_occupation_times_tab) as well as the plot (see: Fig \@ref(fig:bed_occupation_times_tab)) which display the stroke category, corresponding length of stay for patients and stroke probabilities.

```{r bed_occupation_times_fig, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.cap="Bed Occupation Time vs. Stroke Category", fig.label="fig:bed_occupation_times_fig"}

library(ggplot2)

bed_occupation_time_df <- data.frame(
  stroke_category = c("Very Mild", "Mild", "Mild-Moderate", "Moderate", "Moderate-Severe", "Severe"),
  bed_occupation_time = c(4.43,4.46,6.67,6.92,7.74,9.29),
  probability = c(0.0570,0.342, 0.217, 0.136, 0.0971, 0.151)
)

ggplot(bed_occupation_time_df, aes(x = stroke_category, y = bed_occupation_time)) +
  geom_col(fill = "steelblue") +
  theme_minimal()+
  geom_text(aes(label = scales::percent(probability, accuracy = 0.1)), 
            position = position_stack(vjust = 0.5), color = "white", size = 4) +
  theme_minimal() +
  labs(
       x = "Stroke Category",
       y = "Bed Occupation Time (days)")

bed_occupation_time_df %>%
  knitr::kable(caption = "The table displaying stroke categories and corresponding length of stay and probabilities", label = "tab:bed_occupation_times_tab")


  

```

The length of stay for the patients depends on the stroke category, as can be seen from the plot above, the patients in the severe stroke category need to spend 10 days in the stroke care unit. This information needs to be incorporated into the simulation function.

Below are the functions I have created: 

* `generate_interarrival_times`: This function generates the inter-arrival times for the patients. The inter-arrival times for patients are exponentially distributed. This function takes in two arguments: total number of patients and the arrival rate. 

* `assign_stroke_levels`: This function assigns stroke categories to patients in this simulation model. This function takes in two arguments: total number of patients and the stroke level probabilities. The assignment of stroke category to patients is based on the probabilities of the stroke category. 

* `generate_length_of_stay`: This function generates length of stay for the patients based on the category they belong to. This function takes in three arguments: bed occupation times, stroke level (assigned by the `assign_stroke_levels`) and total number of patients. 

With these functions we can create a data frame for the patient arrivals. 

There are two data frames: one of which contains the inter-arrival times, LOS and the stroke categories for 2000 annual load of patients and the other contains all the information for an annual load of 2500 patients. The patient load is expected to rise to 2500 in the coming few years. The two plots summarizes the arrival data sets for 2000 and 2500 patients respectively. 

### Generating the inter-arrival times for Patients

```{r}
# generating the inter-arrival times

set.seed(2023)
# the function below is created to generate the inter-arrival times between the patients.
# the inter arrival follows an exponential distribution hence rexp(), arrival rate is
# defined above

generate_interarrival_times <- function(total_patients, arrival_rate) {
  interarrival_times <- rexp(total_patients, rate = arrival_rate)
  return(interarrival_times)
}

```



### Assigning the stroke level to patients


```{r}
# assigning the stroke levels to the patients

set.seed(2023)

# the function is created to assign patients (from total_patients) randomly a stroke level.
# This assignment is based on the probabilities defined in the stroke_level_prob. 
# To achieve this we use sample()

assign_stroke_levels <- function(total_patients, stroke_level_prob) {
  stroke_levels <- sample(1:length(stroke_level_prob), 
                          size = total_patients, 
                          replace = TRUE, 
                          prob = stroke_level_prob)
  return(stroke_levels)
}


# if the probability of the severe stroke is really high, say 0.7, 
# then the sample() function would generate random samples of 2000 patients 
# wherein most patients would be assigned the severe stroke level category. 

# stroke levels for the present number of patients
stroke_levels <- assign_stroke_levels(total_patients, stroke_level_prob)

# future stroke levels for the future increased number of patients

stroke_levels_future <- assign_stroke_levels(total_patients = total_patients_future,
                                             stroke_level_prob = stroke_level_prob)
```


### Generating the length of stay to patients in the simulation

```{r}
set.seed(2023)
#generating length of stay

generate_length_of_stay <- function(total_patients, bed_occupation_time, stroke_levels) {
  length_of_stay <- numeric(total_patients)
  
  for (i in 1:total_patients) {
    stroke_level <- stroke_levels[i]
    
    if (length(bed_occupation_time[[stroke_level]]) == 1) {
      length_of_stay[i] <- bed_occupation_time[[stroke_level]][1]
    } else {
      length_of_stay[i] <- sample(bed_occupation_time[[stroke_level]][1]:bed_occupation_time[[stroke_level]][2], 1)
    }
  }
  
  return(length_of_stay)
}


# Generating length_of_stay for each patient
length_of_stay <- generate_length_of_stay(total_patients, bed_occupation_time, stroke_levels)

```


### Creating the Arrivals data 


```{r eval=TRUE, echo=TRUE, message=FALSE, include=TRUE}

set.seed(2023)

# generating the arrival data for the current volume of patients

# Add number_of_patients and length_of_stay to arrivals_data

interarrival_times <- generate_interarrival_times(total_patients, arrival_rate)

stroke_levels <- assign_stroke_levels(total_patients, stroke_level_prob)

length_of_stay<- generate_length_of_stay(total_patients, bed_occupation_time, stroke_levels)

arrivals_data <- data.frame(interarrival_times, stroke_levels, length_of_stay)

arrivals_data$stroke_categories <- factor(arrivals_data$stroke_levels,
                                          levels = c(1, 2, 3, 4, 5, 6),
                                          labels = c("Very Mild", "Mild", "Mild-Moderate", "Moderate", "Moderate-Severe", "Severe"))

ggplot(arrivals_data, aes(x = stroke_categories, y = length_of_stay, fill = stroke_categories)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  theme_minimal() +
  scale_y_continuous(breaks = c(1,2,3,4,5,6,7,8,9,10))+
  labs(title = "Mean Length of Stay by Stroke Category",
       x = "Stroke Category",
       y = "Mean Length of Stay (days)") +
  scale_fill_discrete(name = "Stroke Category")

arrivals_data %>% head()

```

```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE, include=TRUE}
set.seed(2023)
# generating the arrival data for the future volume of patients

interarrival_times_future <- generate_interarrival_times(total_patients = total_patients_future,
                                                         arrival_rate_future)
stroke_levels_future <- assign_stroke_levels(total_patients = total_patients_future,
                                             stroke_level_prob = stroke_level_prob)
length_of_stay_future <- generate_length_of_stay(total_patients_future, bed_occupation_time, stroke_levels_future)

arrivals_data_future <- data.frame(interarrival_times_future,stroke_levels_future,
                                   length_of_stay_future)

arrivals_data_future$stroke_categories <- factor(arrivals_data_future$stroke_levels,
                                          levels = c(1, 2, 3, 4, 5, 6),
                                          labels = c("Very Mild", "Mild", "Mild-Moderate", "Moderate", "Moderate-Severe", "Severe"))

ggplot(arrivals_data_future, aes(x = stroke_categories, y = length_of_stay_future, fill = stroke_categories)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  theme_light() +
  scale_y_continuous(breaks = c(1,2,3,4,5,6,7,8,9,10))+
  labs(title = "Mean Length of Stay by Stroke Category",
       x = "Stroke Category",
       y = "Mean Length of Stay (days)") +
  scale_fill_discrete(name = "Stroke Category")

arrivals_data_future %>% head()
```
The plots shows us the mean length of stay for each category of stroke in the arrival data sets (2000 patient load as well as 2500 patient load).

In the next step, I have created the stroke simulation function which simulates the patient arrival, keeps track of the available beds and the ones that are still in use, keeps track of the queue, and then assigns beds to the next patient in the queue when the bed is available.

This function returns a list containing the following elements.

beds: This is a numeric vector representing the remaining bed occupation time for each bed in the hospital ward at the end of the simulation. Each element corresponds to a bed, and a value of 0 indicates that the bed is available for use.

queue: This is a list containing the length of stay for patients who couldn't find an available bed during the simulation and had to wait in the queue. The length of the queue list represents the number of patients who were waiting for a bed at the end of the simulation, and the values in the list represent their length of stay.

length_of_stay: This is a numeric vector containing the length of stay for each patient in the simulation based on their assigned stroke level. The elements in this vector are generated using the generate_length_of_stay function, which takes into account the bed occupation times for different stroke levels and the assigned stroke levels for each patient.

In summary, the output of the stroke_simulation function provides information about the bed occupation times, the queue of waiting patients, and the length of stay for each patient at the end of the simulation.


### Stroke simulation and visualization of the distribution of length of stay of patients in the ward


Below in the plot one can see the frequency (distribution) of the number of days the 2000 patients stayed in the stroke ward in my simulation for 25 beds as well as for  40 beds. One can see how this simulation computed the length of stay for different categories of stroke for 2000 patients based on the stroke probabilities. 


```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE, include=TRUE}

# created the stroke simulation function 

set.seed(2023)

stroke_simulation <- function(total_patients, arrival_rate, 
                              bed_occupation_time, stroke_level_prob, 
                              num_beds) {
  
  interarrival_times <- generate_interarrival_times(total_patients, arrival_rate)
  stroke_levels <- assign_stroke_levels(total_patients, stroke_level_prob)
  length_of_stay <- generate_length_of_stay(total_patients, bed_occupation_time, stroke_levels)
  
  # initializing the beds and queue 
  beds <- rep(0, num_beds)
  queue <- list()
  

# inter-arrival_time is an input parameter for this function, 
# which represents the time between patient arrivals. 
# This variable is based on the generate_interarrival_times function, 
# where we input the total number of patients and arrival rate.

# The pmax function ensures that the bed occupation times do not become negative. 
# A value of 0 in this context means that the bed is available 
# (i.e., the patient has completed their stay)
  
  update_bed_occupation_times <- function(beds, interarrival_time) {
  beds <- pmax(beds - interarrival_time, 0)
  
  # 'beds' is a numeric vector that represents the current remaining 
  # bed occupation time for each bed in the simulation.
  # Each element in this vector corresponds to a bed in the hospital
  # ward. A value of 0 means that the bed is available for use.
  # Subtracting the inter-arrival_time from each element of 'beds' 
  # updates the remaining bed occupation times, considering the 
  # passage of time between patient arrivals.
  # The pmax function is used to ensure that the resulting bed 
  # occupation times do not become negative, meaning that a 
  # bed with a remaining time less than or equal to the interarrival_time
  # will be considered available (set to 0).
  return(beds)
}
  
  # for every patient in total patients (1000)
  
  for (i in 1:total_patients) {
    
    # update the beds variable with the bed occupation times 
    # of all the patients arriving at the inter-arrival times
    
    beds <- update_bed_occupation_times(beds, interarrival_times[i])
    # creating a new variable available beds to keep track 
    # of the available beds the beds that are available will
    # have the bed occupation time of 0 so in this variable 
    # I store the beds that are available hence which(beds==0)
    
    available_beds <- which(beds == 0)
    
    # here if the length of the available beds vector 
    # is greater than 0 which means that 
    # there is at least one bed with bed occupation times ==0 
    # then assign the first available bed to the patient 
    # by setting this available bed (bed occupation times ==0) 
    # to the length of the stay of the patient 
    # (whatever the severity of that patient might be)
    
    if (length(available_beds) > 0) {
      beds[available_beds[1]] <- length_of_stay[i]
    } else {
      # if there is no bed available then append the queue list
      queue <- append(queue, length_of_stay[i])
    }
  }
  
  return(list(beds = beds, queue = queue, length_of_stay =length_of_stay))
}
```

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}
set.seed(2023)

options(scipen = 999)

# stroke_sim_50 <- stroke_simulation(total_patients= total_patients, 
#                                    arrival_rate= arrival_rate, 
#                               bed_occupation_time = bed_occupation_time, 
#                               stroke_level_prob= stroke_level_prob, 
#                               num_beds= 50)

stroke_sim_40 <- stroke_simulation(total_patients= total_patients, 
                                   arrival_rate= arrival_rate, 
                              bed_occupation_time = bed_occupation_time, 
                              stroke_level_prob= stroke_level_prob, 
                              num_beds= 40)

# stroke_sim_30 <- stroke_simulation(total_patients= total_patients, 
#                                    arrival_rate= arrival_rate, 
#                               bed_occupation_time = bed_occupation_time, 
#                               stroke_level_prob= stroke_level_prob,
#                               num_beds= 30)

stroke_sim_25 <- stroke_simulation(total_patients= total_patients, 
                                   arrival_rate= arrival_rate, 
                              bed_occupation_time = bed_occupation_time, 
                              stroke_level_prob= stroke_level_prob, 
                              num_beds= 25)

# long_format_data <- stroke_sim_20 %>%
#   gather(key = "variable", value = "value", starts_with("queue"))

stroke_sim_25 <- data.frame(stroke_sim_25)

stroke_sim_40 <- data.frame(stroke_sim_40)

```


```{r }

library(ggplot2)
stroke_sim_25$length_of_stay <- as.numeric(stroke_sim_25$length_of_stay)

ggplot(stroke_sim_25, aes(x = length_of_stay)) +
  geom_histogram(binwidth = 0.5, fill = "steelblue", alpha = 0.8) +
  theme_minimal() +
  labs(title = "Length of Stay Distribution",
       x = "Length of Stay (days)",
       y = "Frequency")

stroke_sim_40$length_of_stay <- as.numeric(stroke_sim_40$length_of_stay)
stroke_sim_40 <- data.frame(stroke_sim_40)
ggplot(stroke_sim_40, aes(x= length_of_stay)) +
  geom_histogram(binwidh=0.5, fill="darkgreen", alpha=0.7 )+
  theme_light()+
  labs(title = "Length of Stay Distribution",
       x = "Length of Stay (days)",
       y = "Frequency")


# stroke sim future

# stroke_sim_50_f <- stroke_simulation(total_patients= total_patients_future, 
#                                    arrival_rate= arrival_rate_future, 
#                                    bed_occupation_time = bed_occupation_time, 
#                                    stroke_level_prob= stroke_level_prob, 
#                                    num_beds= 50)
# 
# stroke_sim_40_f <- stroke_simulation(total_patients= total_patients_future, 
#                                    arrival_rate= arrival_rate_future, 
#                                    bed_occupation_time = bed_occupation_time, 
#                                    stroke_level_prob= stroke_level_prob, 
#                                    num_beds= 40)
# 
# stroke_sim_30_f <- stroke_simulation(total_patients= total_patients_future, 
#                                      arrival_rate= arrival_rate_future, 
#                                      bed_occupation_time = bed_occupation_time,
#                                      stroke_level_prob= stroke_level_prob, 
#                                      num_beds= 30)
# 
# stroke_sim_20_f <- stroke_simulation(total_patients= total_patients_future, 
#                                      arrival_rate= arrival_rate_future, 
#                                      bed_occupation_time = bed_occupation_time,
#                                      stroke_level_prob= stroke_level_prob, 
#                                      num_beds= 20)
```

Keep in mind that the length of stay is influenced by the stroke severity, and the distribution of patients across different stroke severity categories. A high frequency for a specific length of stay could indicate that a large number of patients have a similar stroke severity, leading to similar bed occupation times.

### Running multiple simulations and computing the performance statistics

In the next step I created a run simulation function; this function takes the arrival rate, bed_occupation_times, stroke level probabilities and the number of simulation that need to be performed. The purpose of this function is to run multiple simulation and for each simulation run, it calculates various performance metrics for different numbers of beds in the hospital, using the `stroke_simulation function`.

This function computes the following metrics for each combination of simulation run and bed count:

`num_beds`: The number of beds in the hospital.
`utilization`: The proportion of beds occupied by patients.
`avg_wait_times`: The average waiting time for patients in the queue.
`max_queue_length`: The maximum length of the patient queue.

This is the maximum number of patients waiting in the queue for a bed at any given time during the simulation. In our example, for 40 beds, the max queue length of 103 patients means that at some point during the simulation, there were 103 patients waiting for a bed simultaneously. (This however, does not mean that there are necessarily going to be 103 patients waiting to be admitted into the ward in the actual scenario.)

`proportion_patients_waiting`: The proportion of patients who had to wait for a bed.
`percent_patients_waiting`: The percentage of patients who had to wait for a bed.
`avg_length_of_stay`: The average length of stay for patients in the hospital.

The percent of patients waiting to be admitted into the ward should be around 5%. Therefore, in the plot displaying the percent of patients waiting against the number of beds there is a horizontal line at 5%.  


```{r}
set.seed(2023)

run_simulation <- function(arrival_rate, 
                           bed_occupation_time, 
                           stroke_level_prob, 
                           total_patients, 
                           num_simulations) {
    num_bed_range <- seq(20,50, by=1)

  performance_metrics_list <- lapply(1:num_simulations, function(simulation) {
    lapply(num_bed_range, function(num_beds) {
      stroke_sim <- stroke_simulation(total_patients =  total_patients,
                                      arrival_rate = arrival_rate,
                                      bed_occupation_time = bed_occupation_time,
                                      stroke_level_prob = stroke_level_prob,
                                      num_beds = num_beds)
                                      
      num_beds <- length(stroke_sim$beds)
      total_patients <- total_patients
      
      occupied_beds <- sum(stroke_sim$beds > 0)
      utilization <- occupied_beds / num_beds
      
      total_wait_times <- sum(unlist(stroke_sim$queue))
      num_patients_queue <- length(stroke_sim$queue)
      avg_wait_times <- total_wait_times / num_patients_queue
      
      average_time_in_queue = total_wait_times / num_patients_queue
      max_queue_length <- length(stroke_sim$queue)
      
      proportion_patients_waiting <- num_patients_queue / total_patients
      percent_patients_waiting <- proportion_patients_waiting * 100
      
      avg_length_of_stay <- (sum(stroke_sim$length_of_stay)) / total_patients
      
      performance_metrics_month <- data.frame(num_beds = num_beds,
                                              utilization = utilization,
                                              avg_wait_times = avg_wait_times,
                                              max_queue_length = max_queue_length,
                                              # min_queue_length = stroke_sim$min_queue_length,
                                              proportion_patients_waiting = proportion_patients_waiting,
                                              percent_patients_waiting = percent_patients_waiting,
                                              avg_length_of_stay = avg_length_of_stay)
                                              
      return(performance_metrics_month)
    })
  })

  return(performance_metrics_list)
}

results <- run_simulation(arrival_rate = arrival_rate, 
                          bed_occupation_time = bed_occupation_time, 
                          stroke_level_prob = stroke_level_prob, 
                          total_patients = total_patients, 
                          num_simulations = 120)

results_future <- run_simulation(arrival_rate = arrival_rate_future,
                                 bed_occupation_time = bed_occupation_time,
                                 stroke_level_prob = stroke_level_prob,
                                 total_patients = total_patients_future,
                                 num_simulations = 120)


```


### Visualising the Performance metrics

```{r}
# Combine all the data frames into one
results_df <- do.call(rbind, lapply(results, function(x) do.call(rbind, x)))


# Load the ggplot2 library
library(ggplot2)

# Plot average waiting times against the number of beds
ggplot(results_df, aes(x = num_beds, y = avg_wait_times)) +
  geom_point() +
  geom_smooth(method = "loess") +
  labs(title = "Average Waiting Times vs. Number of Beds",
       x = "Number of Beds",
       y = "Average Waiting Time (Days)")

# Plot the percent of patients waiting against the number of beds
ggplot(results_df, aes(x = num_beds, y = percent_patients_waiting)) +
  geom_point(size=0.7,
             alpha= 0.5) +
  geom_smooth(method = "loess") +
  theme_minimal() +
  labs(title = "Percent of Patients Waiting vs. Number of Beds",
       x = "Number of Beds",
       y = "Percent of Patients Waiting") +
  geom_hline(yintercept = 5, linetype = "dashed", color = "red", size = 0.5)+
  scale_y_continuous(breaks = c(5,10,15,20,25,30,35,40,45))


# Plot utilization against the number of beds
ggplot(results_df, aes(x = num_beds, y = utilization)) +
  geom_point(size=0.7) +
  geom_smooth(method = "loess") +
  theme_minimal()+
  geom_hline(yintercept = 0.8, linetype = "dashed", color = "red", size = 0.5)+
  labs(title = "Utilization vs. Number of Beds",
       x = "Number of Beds",
       y = "Utilization")

# Plot max queue length against the number of beds
xintersection = 40
yintersection = 103
ggplot(results_df, aes(x = num_beds, y = max_queue_length)) +
  geom_point() +
  geom_smooth(method = "loess") +
  scale_y_continuous(breaks = seq(5, 1000, by = 50))+
  geom_vline(xintercept = 40, linetype="dashed", color = "steelblue", size = 0.5)+
  geom_hline(yintercept = 105, linetype = "dashed", color = "red", size=0.5)+
  geom_point(aes(x = xintersection, y = yintersection), color = "red", size = 1.5)+
  theme_minimal() +
  labs(title = "Maximum Queue Length vs. Number of Beds",
       x = "Number of Beds",
       y = "Maximum Queue Length")




```


```{r}
# visualization for the future

results_df_future <- do.call(rbind, lapply(results_future, function(x) do.call(rbind, x)))

# Load the ggplot2 library
library(ggplot2)

# Plot average waiting times against the number of beds
ggplot(results_df_future, aes(x = num_beds, y = avg_wait_times)) +
  geom_point() +
  geom_smooth(method = "loess") +
  labs(title = "Average Waiting Times vs. Number of Beds",
       x = "Number of Beds",
       y = "Average Waiting Time (Days)")

# Plot the proportion of patients waiting against the number of beds
ggplot(results_df_future, aes(x = num_beds, y = percent_patients_waiting)) +
  geom_point(size=0.7,
             alpha= 0.5) +
  geom_smooth(method = "loess") +
  theme_minimal() +
  labs(title = "Percent of Patients Waiting vs. Number of Beds",
       x = "Number of Beds",
       y = "Percent of Patients Waiting") +
  geom_hline(yintercept = 5, linetype = "dashed", color = "red", size = 0.5)+
  scale_y_continuous(breaks = c(5,10,15,20,25,30,35,40,45)) +
  scale_x_continuous(breaks = c(2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50))


# Plot utilization against the number of beds
ggplot(results_df_future, aes(x = num_beds, y = utilization)) +
  geom_point(size=0.7) +
  geom_smooth(method = "loess") +
  theme_minimal()+
  geom_hline(yintercept = 0.8, linetype = "dashed", color = "red", size = 0.5)+
  labs(title = "Utilization vs. Number of Beds",
       x = "Number of Beds",
       y = "Utilization")

# Plot max queue length against the number of beds
ggplot(results_df_future, aes(x = num_beds, y = max_queue_length)) +
  geom_point() +
  geom_smooth(method = "loess") +
  theme_minimal() +
  labs(title = "Maximum Queue Length vs. Number of Beds",
       x = "Number of Beds",
       y = "Maximum Queue Length")
```


### Data from the BI team Monash Health

```{r}
library(tidyverse)

read_csv("stroke_data.csv") -> stroke

stroke %>% 
  filter(MedicalSpecialty == "Stroke") -> stroke

stroke %>%
  select(WardName) %>%
  distinct()
```



